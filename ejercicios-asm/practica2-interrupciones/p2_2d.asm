EOI EQU 20H
IMR EQU 21H

INT0 EQU 24H

PA EQU 30H ;ESTADO
PB EQU 31H ;LUCES
CA EQU 32H
CB EQU 33H

ORG 3000H
	F10_SUB: MOV AL, 11111111B
	OUT IMR, AL
	
	MOV FLAG, 1 ;MOVEMOS FLAG EN 1 PARA QUE CORTE LA LECTURA
	
	MOV AL, EOI
	OUT EOI, AL
	
	IRET

ORG 1000H
	FLAG DB 0
	LONGITUD DB 0
	STRING DB ?
	
ORG 2000H
	;CONFIGURAMOS PIO
	;----------------
	MOV AL, 11111101B
	OUT CA, AL
	
	MOV AL, 00000000B
	OUT CB, AL
	
	;SUBRUTINA VECTOR
	;----------------
	MOV AX, F10_SUB
	MOV BX, 40
	MOV [BX], AX
	
	;CONFIGURAMOS EL PIC
	;-------------------
	CLI
		MOV AL, 11111110B
		OUT IMR, AL
		
		MOV AL, 10
		OUT INT0, AL
	STI
	
	;LEEMOS CARACTERES
	;-----------------
	
	MOV BX, OFFSET STRING
	
	LECTURA: INT 6
	INC BX
	INC LONGITUD
	CMP FLAG, 0
	JZ LECTURA
	
	DEC LONGITUD
	
	;IMPRIME
	;-------
	MOV BX, OFFSET STRING
	
	IMPRIME: CMP LONGITUD, 0
	JZ FIN
	POLL: IN AL, PA
	AND AL, 00000001B
	JNZ POLL
	
	;MANDAMOS CARACTER
	MOV AL, [BX]
	OUT PB, AL
	
	;HABILITAMOS STROBE
	IN AL, PA
	OR AL, 00000010B
	OUT PA, AL
	
	;DESHABILITAMOS STROBE
	IN AL, PA
	AND AL, 11111101B
	OUT PA, AL
	
	INC BX
	DEC LONGITUD
	JMP IMPRIME
	
FIN: INT 0
END
	